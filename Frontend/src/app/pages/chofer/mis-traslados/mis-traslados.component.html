<!-- src/app/pages/chofer/mis-traslados/mis-traslados.component.html -->
<div class="container-fluid py-4">
  
  <!-- Loading State -->
  @if (isLoading()) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-3 text-muted">Cargando traslados...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="alert alert-danger" role="alert">
      <i class="bi bi-exclamation-triangle me-2"></i>
      {{ error() }}
      <button class="btn btn-sm btn-outline-danger ms-3" (click)="cargarTraslados()">
        Reintentar
      </button>
    </div>
  }

  <!-- Content -->
  @if (!isLoading() && !error()) {
    
    <!-- Traslados Actuales -->
    @if (trasladosActuales().length > 0) {
      <div class="mb-5">
        <h4 class="mb-4 fw-bold text-dark">
          <i class="bi bi-play-circle text-primary me-2"></i>
          Traslado{{ trasladosActuales().length > 1 ? 's' : '' }} Actual{{ trasladosActuales().length > 1 ? 'es' : '' }}
        </h4>
        
        @for (traslado of trasladosActuales(); track traslado.idTraslado) {
          <div class="card shadow-sm border-0 mb-3">
            <div class="card-body p-4">
              
              <!-- Header del traslado -->
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="d-flex align-items-center">
                  <div class="rounded-circle bg-primary bg-opacity-10 p-2 me-3">
                    <i class="bi bi-person-fill text-primary fs-5"></i>
                  </div>
                  <div>
                    <h5 class="mb-1 fw-bold">{{ traslado.nombreCompletoPaciente }}</h5>
                    <div class="d-flex align-items-center text-muted">
                      <span class="small">Paciente</span>
                      @if (traslado.sillaRueda) {
                        <i class="bi bi-wheelchair"></i>
                      }
                    </div>
                  </div>
                </div>
                <div class="d-flex gap-2">
                  <button class="btn btn-primary btn-sm d-flex align-items-center" 
                          (click)="contactarPaciente(traslado)">
                    <i class="bi bi-telephone me-1"></i>
                    Contactar
                  </button>
                  <button class="btn btn-danger btn-sm d-flex align-items-center"
                          (click)="finalizarTraslado(traslado)"
                          [disabled]="!traslado.puedeFinalizar">
                    <i class="bi bi-stop-circle me-1"></i>
                    Finalizar
                  </button>
                </div>
              </div>

              <!-- Origen y Destino -->
              <div class="row mb-3">
                <div class="col-md-6">
                  <div class="d-flex align-items-start">
                    <i class="bi bi-geo-alt text-success me-2 mt-1"></i>
                    <div>
                      <div class="small text-muted fw-semibold">Origen</div>
                      <div class="fw-medium">{{ traslado.direccionOrigen }}</div>
                      <div class="small text-muted">Recogido: {{ formatearHora(traslado.horaProgramada) }}</div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="d-flex align-items-start">
                    <i class="bi bi-geo-alt-fill text-danger me-2 mt-1"></i>
                    <div>
                      <div class="small text-muted fw-semibold">Destino</div>
                      <div class="fw-medium">{{ traslado.direccionDestino }}</div>
                      <div class="small text-muted">ETA: {{ formatearHora(traslado.horaProgramada) }}</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Tiempo y Ruta -->
              <div class="row">
                <div class="col-md-6">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-clock text-warning me-2"></i>
                    <div>
                      <div class="small text-muted">Tiempo según tráfico</div>
                      <div class="fw-bold text-success">{{ obtenerTiempoMockeado() }}</div>
                      <div class="small text-muted">Actualizado hace 1 min</div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <button class="btn btn-primary d-flex align-items-center"
                          (click)="abrirGoogleMaps(traslado)">
                    <i class="bi bi-map me-2"></i>
                    Abrir en Google Maps
                  </button>
                </div>
              </div>

            </div>
          </div>
        }
      </div>
    }

    <!-- Próximos Traslados -->
    @if (proximosTraslados().length > 0) {
      <div class="mb-4">
        <h4 class="mb-4 fw-bold text-dark">
          <i class="bi bi-clock text-warning me-2"></i>
          Próximos Traslados
        </h4>
        
        @for (traslado of proximosTraslados(); track traslado.idTraslado) {
          <div class="card shadow-sm border-0 mb-3">
            <div class="card-body p-3">
              
              <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                  <div class="rounded-circle bg-warning bg-opacity-10 p-2 me-3">
                    <i class="bi bi-clock text-warning"></i>
                  </div>
                  <div>
                    <h6 class="mb-1 fw-bold">{{ traslado.nombreCompletoPaciente }}</h6>
                    <div class="fw-semibold text-primary mb-1">
                      {{ formatearHora(traslado.horaProgramada) }} - {{ traslado.direccionDestino }}
                    </div>
                    <div class="small text-muted d-flex align-items-center">
                      @if (traslado.sillaRueda) {
                        
                        <i class="bi bi-person-wheelchair text-dark"title="Requiere silla de ruedas"></i>
                      }
                    </div>
                  </div>
                </div>
                <button class="btn btn-success btn-sm"
                        (click)="iniciarTraslado(traslado)"
                        [disabled]="!traslado.puedeIniciar">
                  <i class="bi bi-play-fill me-1"></i>
                  Iniciar
                </button>
              </div>

            </div>
          </div>
        }
      </div>
    }

    <!-- Estado vacío -->
    @if (trasladosActuales().length === 0 && proximosTraslados().length === 0) {
      <div class="text-center py-5">
        <i class="bi bi-calendar-check text-muted" style="font-size: 4rem;"></i>
        <h5 class="mt-3 text-muted">No hay traslados programados para hoy</h5>
        <p class="text-muted">Disfruta tu día libre</p>
      </div>
    }

  }

</div>